# -------------------------
# Stage 1: Build the React app
# -------------------------
FROM node:18-alpine AS frontend-builder

WORKDIR /app/client

# install only deps, so rebuild is cached
COPY client/package*.json ./
RUN npm install

# copy source & build
COPY client/ ./
RUN npm run build


# -------------------------
# Stage 2: Setup the Express server
# -------------------------
FROM node:18-alpine

WORKDIR /app

# install server deps
COPY package*.json ./
RUN npm install --production

# copy server code
COPY . .

# copy built frontend into Express static folder
# (assumes your Express serves ./public)
COPY --from=frontend-builder /app/client/dist ./public

# expose and run
EXPOSE 3013
CMD ["node", "index.js"]